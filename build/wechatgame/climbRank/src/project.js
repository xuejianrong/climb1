window.__require=function e(t,n,a){function r(c,s){if(!n[c]){if(!t[c]){var i=c.split("/");if(i=i[i.length-1],!t[i]){var l="function"==typeof __require&&__require;if(!s&&l)return l(i,!0);if(o)return o(i,!0);throw new Error("Cannot find module '"+c+"'")}}var u=n[c]={exports:{}};t[c][0].call(u.exports,function(e){return r(t[c][1][e]||e)},u,u.exports,e,t,n,a)}return n[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<a.length;c++)r(a[c]);return r}({launch:[function(e,t,n){"use strict";cc._RF.push(t,"e53e6YiUd9FJLf8yIQu1n47","launch"),cc.Class({extends:cc.Component,properties:{content:cc.Node,prefab:cc.Prefab,selfRankNum:cc.Label,selfName:cc.Label,selfScore:cc.Label,selfHead:cc.Sprite,keyName:"friendRank",list:[],openid:"",user:""},start:function(){var e=this;wx.onMessage(function(t){console.log("onMessage",t),0===t.type&&t.data.score>e.getKVDataVal(e.user.KVDataList,e.keyName)?(e.content.removeAllChildren(),wx.setUserCloudStorage({KVDataList:[{key:e.keyName,value:JSON.stringify({wxgame:t.data})}],success:function(t){console.log("setUserCloudStorage","success",t),e.getRankList(e.user)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})):1===t.type&&(e.openid=t.openid,wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(t){console.log("\u5f53\u524d\u7528\u6237\u4fe1\u606f",t.data);var n=t.data[0];e.getRankList(n)},fail:function(e){console.log("\u83b7\u53d6\u4fe1\u606f\u5931\u8d25",e)}}))})},getRankList:function(e){var t=this;wx.getFriendCloudStorage({keyList:[this.keyName],success:function(n){var a=n.data;a.sort(function(e,n){return 0==e.KVDataList.length&&0==n.KVDataList.length?0:0==e.KVDataList.length?1:0==n.KVDataList.length?-1:t.getScoreVal(n.KVDataList[0].value)-t.getScoreVal(e.KVDataList[0].value)}),console.log("\u5173\u7cfb\u94fe\u6392\u884c\u699c\uff1a",a);for(var r=0;r<a.length;r++){var o=a[r];t.createUserBlock(o,r+1),o.openid===t.openid&&(t.user=o,t.user.rankNum=r+1)}t.user||(t.user=e),t.createSelfBlock(t.user),t.list=a},fail:function(e){console.error(e)}})},createUserBlock:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.createPrefab(),a=e.nickName?e.nickName:e.nickname,r=e.avatarUrl,o=n.getChildByName("userName").getComponent(cc.Label),c=n.getChildByName("rankNum").getComponent(cc.Label),s=n.getChildByName("score").getComponent(cc.Label),i=n.getChildByName("mask").children[0].getComponent(cc.Sprite);o.string=a,c.string=t,s.string=this.getKVDataVal(e.KVDataList,"score"),cc.loader.load({url:r,type:"png"},function(e,t){e&&console.error(e),i.spriteFrame=new cc.SpriteFrame(t)})},createSelfBlock:function(e){var t=this;this.selfName.string=e.nickName?e.nickName:e.nickname,this.selfRankNum.string=e.rankNum||"",this.selfScore.string=this.getKVDataVal(e.KVDataList,this.keyName)||"0",cc.loader.load({url:e.avatarUrl,type:"png"},function(e,n){e&&console.error(e),t.selfHead.spriteFrame=new cc.SpriteFrame(n)})},createPrefab:function(){var e=cc.instantiate(this.prefab);return e.parent=this.content,e},getKVDataVal:function(e,t){var n=(e||[]).filter(function(e){return e.key=t});return n.length>0?this.getScoreVal(n[0].value):0},getScoreVal:function(e){return JSON.parse(e).wxgame.score}}),cc._RF.pop()},{}]},{},["launch"]);