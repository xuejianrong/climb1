window.__require=function e(t,a,n){function r(s,c){if(!a[s]){if(!t[s]){var i=s.split("/");if(i=i[i.length-1],!t[i]){var l="function"==typeof __require&&__require;if(!c&&l)return l(i,!0);if(o)return o(i,!0);throw new Error("Cannot find module '"+s+"'")}}var u=a[s]={exports:{}};t[s][0].call(u.exports,function(e){return r(t[s][1][e]||e)},u,u.exports,e,t,a,n)}return a[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<n.length;s++)r(n[s]);return r}({launch:[function(e,t,a){"use strict";cc._RF.push(t,"e53e6YiUd9FJLf8yIQu1n47","launch"),cc.Class({extends:cc.Component,properties:{content:cc.Node,prefab:cc.Prefab,selfRankNum:cc.Label,selfName:cc.Label,selfScore:cc.Label,selfHead:cc.Sprite,keyName:"friendRank",list:[],openid:"",user:""},start:function(){var e=this;wx.onMessage(function(t){console.log("onMessage",t),0===t.type&&e.user.KVDataList&&t.data.score>e.getKVDataVal(e.user.KVDataList,e.keyName)?wx.setUserCloudStorage({KVDataList:[{key:e.keyName,value:JSON.stringify({wxgame:t.data})}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}}):1===t.type&&(e.openid=t.openid,wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(t){console.log("userInfo",t.data);var a=t.data[0];e.getRankList(a)},fail:function(e){console.log("\u83b7\u53d6\u4fe1\u606f\u5931\u8d25",e)}}))})},getRankList:function(e){var t=this;wx.getFriendCloudStorage({keyList:[this.keyName],success:function(a){var n=a.data;n.sort(function(e,a){return 0==e.KVDataList.length&&0==a.KVDataList.length?0:0==e.KVDataList.length?1:0==a.KVDataList.length?-1:t.getScoreVal(a.KVDataList[0].value)-t.getScoreVal(e.KVDataList[0].value)}),console.log("\u5173\u7cfb\u94fe\u6392\u884c\u699c\uff1a",n);for(var r=0;r<n.length;r++){var o=n[r];t.createUserBlock(o,r+1),o.openid===t.openid&&(t.user=o,t.user.rankNum=r+1)}t.user||(t.user=e),t.createSelfBlock(t.user),t.list=n},fail:function(e){console.error(e)}})},createUserBlock:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=this.createPrefab(),n=e.nickName?e.nickName:e.nickname,r=e.avatarUrl,o=a.getChildByName("userName").getComponent(cc.Label),s=a.getChildByName("rankNum").getComponent(cc.Label),c=a.getChildByName("score").getComponent(cc.Label),i=a.getChildByName("mask").children[0].getComponent(cc.Sprite);o.string=n,s.string=t,c.string=this.getKVDataVal(e.KVDataList,"score"),cc.loader.load({url:r,type:"png"},function(e,t){e&&console.error(e),i.spriteFrame=new cc.SpriteFrame(t)})},createSelfBlock:function(e){var t=this;this.selfName.string=e.nickName?e.nickName:e.nickname,this.selfRankNum.string=e.rankNum||"",this.selfScore.string=this.getKVDataVal(e.KVDataList,this.keyName)||"0",cc.loader.load({url:e.avatarUrl,type:"png"},function(e,a){e&&console.error(e),t.selfHead.spriteFrame=new cc.SpriteFrame(a)})},createPrefab:function(){var e=cc.instantiate(this.prefab);return e.parent=this.content,e},getKVDataVal:function(e,t){var a=e.filter(function(e){return e.key=t});return a.length>0?this.getScoreVal(a[0].value):0},getScoreVal:function(e){return JSON.parse(e).wxgame.score}}),cc._RF.pop()},{}]},{},["launch"]);