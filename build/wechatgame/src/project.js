window.__require=function t(e,i,r){function o(n,a){if(!i[n]){if(!e[n]){var c=n.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+n+"'")}}var l=i[n]={exports:{}};e[n][0].call(l.exports,function(t){return o(e[n][1][t]||t)},l,l.exports,t,e,i,r)}return i[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<r.length;n++)o(r[n]);return o}({CtrlView:[function(t,e,i){"use strict";cc._RF.push(e,"fc7a1Vco1RLp45w+aBK076Z","CtrlView");var r=t("../Global/Global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},startGame:function(){this.node.runAction(cc.removeSelf()),this.gameView.startGame()},redirectToRank:function(){r.rankViewStatus=0,cc.director.loadScene("rank")}}),cc._RF.pop()},{"../Global/Global":"Global"}],GameView:[function(t,e,i){"use strict";cc._RF.push(e,"74384f4Pr1Au47VINXpucOD","GameView");var r=t("../Global/Global");cc.Class({extends:cc.Component,properties:{isStart:!1,gameCanvas:cc.Node,ctrlViewPrefab:cc.Prefab,ctrlView:cc.Node,stair:cc.Prefab,stairs:[cc.Node],player:cc.Node,progressBox:cc.Node,progress:cc.Node,overViewPrefab:cc.Prefab,primaryHeight:2,firstEndScaleX:.8,firstEndScaleY:.5,firstY:200,firstEndY:0,speed:143.75,scaleXChange:.13,scaleYChange:.18,initX:0,initYDistance:0,initY:0,jumpHeight:350,moveTime:0,isTouch:!1,prevTouchX:0,x:0,goldContinuousCount:0,score:0,addCount:0,scoreLabel:cc.RichText,step:0,preStep:0},onLoad:function(){this.createCtrlView(),this.createStair(),this.initPlayer(),wx.onShareAppMessage(function(){return{title:r.shareTitle,imageUrl:r.shareImageUrl}}),wx.cloud?wx.cloud.init():console.error("\u8bf7\u4f7f\u7528 2.2.3 \u6216\u4ee5\u4e0a\u7684\u57fa\u7840\u5e93\u4ee5\u4f7f\u7528\u4e91\u80fd\u529b")},update:function(t){var e=this;if(this.isStart){var i=(this.firstY-this.firstEndY)/this.speed;this.stairs.forEach(function(r,o){if(0===o)r.y-=e.speed*t,r.scaleX+=e.firstEndScaleX/i*t,r.scaleY+=e.firstEndScaleY/i*t;else{r.scaleX+=e.scaleXChange/i*t,r.scaleY+=e.scaleYChange/i*t;var s=e.stairs[o-1],n=e.primaryHeight/2*s.scaleY,a=e.primaryHeight/2*r.scaleY;r.y=s.y-n-a}}),this.moveTime+=t;var r=i/2,o=2*this.jumpHeight/(r*r),s=o*r-o*this.moveTime;this.player.y+=s*t,this.isTouch&&this.isStart&&(this.player.x=this.x)}},lateUpdate:function(){if(this.stairs[0].y<=this.firstEndY){this.addStep();var t=this.stairs.pop();t.getComponent("Stair").init(),this.stairs.unshift(t),t.scaleX=0,t.scaleY=0,t.y=this.firstY,this.player.y=this.initY,this.moveTime=0}this.player.y>=this.initY+this.jumpHeight&&(this.player.y=this.initY+this.jumpHeight)},createCtrlView:function(){this.ctrlView||(this.ctrlView=cc.instantiate(this.ctrlViewPrefab),this.ctrlView.getComponent("CtrlView").gameView=this),this.gameCanvas.addChild(this.ctrlView)},createStair:function(){for(var t=0;t<5;){var e=cc.instantiate(this.stair),i=e.getComponent("Stair");if(i.gameView=this.node,t>1&&(i.noBarrier=!0),this.stairs[t]=e,this.node.addChild(e),0===t)e.scaleX=0,e.scaleY=0,e.setPosition(cc.v2(0,this.firstY));else{e.scaleX=this.firstEndScaleX+(t-1)*this.scaleXChange,e.scaleY=this.firstEndScaleY+(t-1)*this.scaleYChange;var r=this.stairs[t-1],o=this.primaryHeight/2*r.scaleY,s=this.primaryHeight/2*e.scaleY;e.setPosition(cc.v2(0,r.y-o-s)),1===t&&(this.firstEndY=e.y),3===t&&(this.initY=e.y+this.initYDistance),this.player.y=this.initY}t+=1}},initPlayer:function(){this.player.x=this.initX,this.player.y=this.initY,this.player.setSiblingIndex(10),this.progressBox.setSiblingIndex(10),this.x=this.initX},touchStartHandle:function(t){this.isTouch=!0,this.prevTouchX=t.getLocation().x},touchMoveHandle:function(t){var e=t.getLocation().x;this.x+=e-this.prevTouchX,this.prevTouchX=e},touchEndHandle:function(t){this.isTouch=!1},startGame:function(){this.isStart=!0,this.node.on("touchmove",this.touchMoveHandle,this),this.node.on("touchstart",this.touchStartHandle,this),this.node.on("touchend",this.touchEndHandle,this),wx.cloud.callFunction({name:"login",data:{},success:function(t){console.log("[\u4e91\u51fd\u6570] [login] user openid: ",t.result.openid)},fail:function(t){console.error("[\u4e91\u51fd\u6570] [login] \u8c03\u7528\u5931\u8d25",t)}})},gameOver:function(){var t=this;this.isStart=!1;var e=cc.instantiate(this.overViewPrefab),i=e.getComponent("OverCtrl");i.gameView=this,this.scheduleOnce(function(){i.setting(),t.gameCanvas.addChild(e)},1.5)},getGold:function(){this.step===this.preStep+1?this.goldContinuousCount+=1:this.goldContinuousCount=1,this.preStep=this.step,this.goldContinuousCount>4?this.addCount=50:this.addCount=20+10*(this.goldContinuousCount-1),this.score+=this.addCount,this.scoreLabel.string="<color=#19C1A7><b>"+this.score+"</b><color>"},addStep:function(){this.step+=1;var t=this.step/100*430;this.progress.height=t>25?t:25},clearGame:function(){this.stairs.forEach(function(t){return t.removeFromParent()}),this.stairs.length=0,this.createStair(),this.initPlayer(),this.progress.height=25,this.goldContinuousCount=0,this.score=0,this.addCount=0,this.step=0,this.preStep=0,this.scoreLabel.string="<color=#19C1A7><b>"+this.score+"</b><color>",this.moveTime=0;var t=this.player.getComponent("Player");t.activeNode.runAction(cc.show()),t.overNode.runAction(cc.hide())}}),cc._RF.pop()},{"../Global/Global":"Global"}],Global:[function(t,e,i){"use strict";cc._RF.push(e,"cddabeYMPRAybU78zrtQXz3","Global"),e.exports={rankViewStatus:0,shareTitle:"\u5206\u4eab\u6807\u9898",shareImageUrl:"http://static.live.nagezan.net/live/19cc06e0-3a5f-48d5-93f9-d0414cd21f51.jpg"},cc._RF.pop()},{}],OverCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"ad19cEPgGpNio7PxiYaBZOj","OverCtrl");var r=t("../Global/Global");cc.Class({extends:cc.Component,properties:{score:cc.RichText,desc:cc.Label},onLoad:function(){},setting:function(){this.score.string="\u672c\u6b21\u5f97\u5206<br/>"+this.gameView.score,this.desc.string="\u6bcf\u59295\u6b21\u590d\u6d3b\u673a\u4f1a\uff0c\u4eca\u65e5\u5269\u4f59\uff1a2\u6b21"},skip:function(){r.rankViewStatus=1,cc.director.loadScene("rank")},share:function(){cc.log("onShare"),wx.shareAppMessage({title:r.shareTitle,imageUrl:r.shareImageUrl})}}),cc._RF.pop()},{"../Global/Global":"Global"}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"77cadpxUZRO2ql+MLV+ZuIs","Player"),cc.Class({extends:cc.Component,properties:{gameView:cc.Node,activeNode:cc.Node,overNode:cc.Node},onLoad:function(){cc.director.getCollisionManager().enabled=!0,this.overNode.runAction(cc.hide())},onCollisionEnter:function(t){var e=this.gameView.getComponent("GameView");this.node.y>=e.initY&&this.node.y<=e.initY+120&&e.isStart&&("Tree"===t.node.name?(console.log("game over"),this.gameOver(),e.gameOver()):"Gold"===t.node.name&&(e.getGold(),t.node.runAction(cc.removeSelf())))},gameOver:function(){this.activeNode.runAction(cc.hide()),this.overNode.runAction(cc.show())}}),cc._RF.pop()},{}],RankView:[function(t,e,i){"use strict";cc._RF.push(e,"e9620nXcKBMDo+6QzBkQkh6","RankView");var r=t("../Global/Global");cc.Class({extends:cc.Component,properties:{btnBack:cc.Node,btnGroupRank:cc.Node,btnHome:cc.Node,btnHome2:cc.Node,btnPlayAgain:cc.Node,btnChallenge:cc.Node,btnStart:cc.Node},onLoad:function(){0===r.rankViewStatus?(this.btnHome.removeFromParent(),this.btnHome2.removeFromParent(),this.btnPlayAgain.removeFromParent(),this.btnChallenge.removeFromParent(),this.btnStart.removeFromParent()):1===r.rankViewStatus?(this.btnHome2.removeFromParent(),this.btnBack.removeFromParent(),this.btnGroupRank.removeFromParent(),this.btnStart.removeFromParent()):(this.btnHome.removeFromParent(),this.btnBack.removeFromParent(),this.btnGroupRank.removeFromParent(),this.btnPlayAgain.removeFromParent(),this.btnChallenge.removeFromParent())},back:function(){cc.director.loadScene("game")},share:function(){cc.log("onShare"),wx.shareAppMessage({title:r.shareTitle,imageUrl:r.shareImageUrl})}}),cc._RF.pop()},{"../Global/Global":"Global"}],Stair:[function(t,e,i){"use strict";cc._RF.push(e,"b408awkSpRBPri4LoPCjvhR","Stair"),cc.Class({extends:cc.Component,properties:{barrierNum:0,posiNum:0,barrierPositions:[],barriers:[cc.Node],noBarrier:!1,barrierPrefab:cc.Prefab,goldPrefab:cc.Prefab,gold:cc.Node,goldPosition:-2},onLoad:function(){this.noBarrier||this.init()},init:function(){this.randomPosition(),this.createBarrier(),this.createGold()},randomPosition:function(){this.barrierPositions.length=0;for(var t=[],e=0,i=0,r=0;e<this.posiNum;)t.push(e++);for(this.goldPosition=parseInt((t.length-4)*Math.random()+2,10),t.splice(this.goldPosition,1);i<this.barrierNum;)r=parseInt(t.length*Math.random(),10),this.barrierPositions.push(t[r]),t.splice(r,1),i+=1;this.barrierPositions.sort(function(t,e){return t>e})},createBarrier:function(){for(var t=this;this.barrierPositions.length!==this.barriers.length;){var e=cc.instantiate(this.barrierPrefab);this.barriers.push(e),this.node.addChild(e)}this.barriers.forEach(function(e,i){e.setPosition(cc.v2(70*t.barrierPositions[i]-350+35,110))})},createGold:function(){this.gold||(this.gold=cc.instantiate(this.goldPrefab)),this.gold._parent||this.node.addChild(this.gold),this.gold.setPosition(cc.v2(70*this.goldPosition-350+35,110))}}),cc._RF.pop()},{}]},{},["Global","CtrlView","GameView","OverCtrl","Player","RankView","Stair"]);