window.__require=function t(e,i,o){function s(r,a){if(!i[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+r+"'")}}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){return s(e[r][1][t]||t)},l,l.exports,t,e,i,o)}return i[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<o.length;r++)s(o[r]);return s}({CtrlView:[function(t,e,i){"use strict";cc._RF.push(e,"fc7a1Vco1RLp45w+aBK076Z","CtrlView");var o=t("../Global/Global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},startGame:function(){this.node.runAction(cc.removeSelf()),this.gameView.startGame()},redirectToRank:function(){o.rankViewStatus=0,cc.director.loadScene("rank")}}),cc._RF.pop()},{"../Global/Global":"Global"}],GameView:[function(t,e,i){"use strict";cc._RF.push(e,"74384f4Pr1Au47VINXpucOD","GameView");var o=t("../Global/Global");cc.Class({extends:cc.Component,properties:{isStart:!1,gameCanvas:cc.Node,ctrlViewPrefab:cc.Prefab,ctrlView:cc.Node,stair:cc.Prefab,stairs:[cc.Node],player:cc.Node,progressBox:cc.Node,progress:cc.Node,overViewPrefab:cc.Prefab,primaryHeight:2,firstEndScaleX:.8,firstEndScaleY:.5,firstY:200,firstEndY:0,speed:143.75,scaleXChange:.13,scaleYChange:.18,initX:0,initYDistance:0,initY:0,jumpHeight:350,moveTime:0,isTouch:!1,prevTouchX:0,x:0,canTouchStart:!1,goldContinuousCount:0,score:0,addCount:0,scoreLabel:cc.RichText,step:0,preStep:0},onLoad:function(){this.createCtrlView(),this.createStair(),this.initPlayer(),wx.onShareAppMessage(function(){return{title:o.shareTitle,imageUrl:o.shareImageUrl}}),wx.cloud?(wx.cloud.init(),o.db=wx.cloud.database()):console.error("\u8bf7\u4f7f\u7528 2.2.3 \u6216\u4ee5\u4e0a\u7684\u57fa\u7840\u5e93\u4ee5\u4f7f\u7528\u4e91\u80fd\u529b")},update:function(t){var e=this;if(this.isStart){var i=(this.firstY-this.firstEndY)/this.speed;this.stairs.forEach(function(o,s){if(0===s)o.y-=e.speed*t,o.scaleX+=e.firstEndScaleX/i*t,o.scaleY+=e.firstEndScaleY/i*t;else{o.scaleX+=e.scaleXChange/i*t,o.scaleY+=e.scaleYChange/i*t;var n=e.stairs[s-1],r=e.primaryHeight/2*n.scaleY,a=e.primaryHeight/2*o.scaleY;o.y=n.y-r-a}}),this.moveTime+=t;var o=i/2,s=2*this.jumpHeight/(o*o),n=s*o-s*this.moveTime;this.player.y+=n*t,this.isTouch&&this.isStart&&(this.player.x=this.x)}},lateUpdate:function(){if(this.stairs[0].y<=this.firstEndY){this.addStep();var t=this.stairs.pop();t.getComponent("Stair").init(),this.stairs.unshift(t),t.scaleX=0,t.scaleY=0,t.y=this.firstY,this.player.y=this.initY,this.moveTime=0}this.player.y>=this.initY+this.jumpHeight&&(this.player.y=this.initY+this.jumpHeight)},createCtrlView:function(){this.ctrlView||(this.ctrlView=cc.instantiate(this.ctrlViewPrefab),this.ctrlView.getComponent("CtrlView").gameView=this),this.gameCanvas.addChild(this.ctrlView)},createStair:function(){for(var t=0;t<5;){var e=cc.instantiate(this.stair),i=e.getComponent("Stair");if(i.gameView=this.node,t>1&&(i.noBarrier=!0),this.stairs[t]=e,this.node.addChild(e),0===t)e.scaleX=0,e.scaleY=0,e.setPosition(cc.v2(0,this.firstY));else{e.scaleX=this.firstEndScaleX+(t-1)*this.scaleXChange,e.scaleY=this.firstEndScaleY+(t-1)*this.scaleYChange;var o=this.stairs[t-1],s=this.primaryHeight/2*o.scaleY,n=this.primaryHeight/2*e.scaleY;e.setPosition(cc.v2(0,o.y-s-n)),1===t&&(this.firstEndY=e.y),3===t&&(this.initY=e.y+this.initYDistance),this.player.y=this.initY}t+=1}},initPlayer:function(){this.player.x=this.initX,this.player.y=this.initY,this.player.setSiblingIndex(10),this.progressBox.setSiblingIndex(10),this.x=this.initX},touchStartHandle:function(t){this.canTouchStart&&(this.isStart=!0,this.canTouchStart=!1),this.isTouch=!0,this.prevTouchX=t.getLocation().x},touchMoveHandle:function(t){var e=t.getLocation().x;this.x+=e-this.prevTouchX,this.prevTouchX=e},touchEndHandle:function(t){this.isTouch=!1},startGame:function(){var t=this;this.isStart=!0,this.node.on("touchmove",this.touchMoveHandle,this),this.node.on("touchstart",this.touchStartHandle,this),this.node.on("touchend",this.touchEndHandle,this),o.openid?this.getData():wx.cloud.callFunction({name:"login",data:{},success:function(e){console.log("[\u4e91\u51fd\u6570] [login] user openid: ",e.result.openid),o.openid=e.result.openid,t.getData()},fail:function(t){console.error("[\u4e91\u51fd\u6570] [login] \u8c03\u7528\u5931\u8d25",t)}})},gameOver:function(){var t=this;if(this.isStart=!1,o.hasReplay)o.rankViewStatus=1,cc.director.loadScene("rank");else{var e=cc.instantiate(this.overViewPrefab),i=e.getComponent("OverCtrl");i.gameView=this,this.scheduleOnce(function(){i.setting(),t.gameCanvas.addChild(e)},1.5)}},getGold:function(){this.step===this.preStep+1?this.goldContinuousCount+=1:this.goldContinuousCount=1,this.preStep=this.step,this.goldContinuousCount>4?this.addCount=50:this.addCount=20+10*(this.goldContinuousCount-1),this.score+=this.addCount,this.scoreLabel.string="<color=#19C1A7><b>"+this.score+"</b><color>"},addStep:function(){this.step+=1;var t=this.step/100*430;this.progress.height=t>25?t:25},clearGame:function(t){t||(this.score=0,this.step=0,this.progress.height=25),this.stairs.forEach(function(t){return t.removeFromParent()}),this.stairs.length=0,this.createStair(),this.initPlayer(),this.goldContinuousCount=0,this.addCount=0,this.preStep=0,this.scoreLabel.string="<color=#19C1A7><b>"+this.score+"</b><color>",this.moveTime=0;var e=this.player.getComponent("Player");e.activeNode.runAction(cc.show()),e.overNode.runAction(cc.hide())},getData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.openid;o.queryData(t)},updateData:function(){}}),cc._RF.pop()},{"../Global/Global":"Global"}],Global:[function(t,e,i){"use strict";cc._RF.push(e,"cddabeYMPRAybU78zrtQXz3","Global"),e.exports={rankViewStatus:0,shareTitle:"\u5206\u4eab\u6807\u9898",shareImageUrl:"http://static.live.nagezan.net/live/19cc06e0-3a5f-48d5-93f9-d0414cd21f51.jpg",openid:"",challengeCountersAll:5,challengeCounters:0,db:"",counterid:"",queryData:function(t){var e=this;this.db.collection("challengeCounters").where({_openid:t}).get({success:function(t){console.log("[\u6570\u636e\u5e93] [\u67e5\u8be2\u8bb0\u5f55] \u6210\u529f: ",t);var i=t.data;0===i.length?(e.addData({counters:e.challengeCountersAll,score:0}),e.challengeCounters=e.challengeCountersAll):(e.challengeCounters=i[0].counters,e.counterid=i[0]._id)},fail:function(t){console.error("[\u6570\u636e\u5e93] [\u67e5\u8be2\u8bb0\u5f55] \u5931\u8d25\uff1a",t)}})},addData:function(t){var e=this;this.db.collection("challengeCounters").add({data:Object.assign({date:new Date},t),success:function(t){console.log("[\u6570\u636e\u5e93] [\u65b0\u589e\u8bb0\u5f55] \u6210\u529f\uff0c\u8bb0\u5f55 _id: ",t._id),e.counterid=t._id},fail:function(t){console.error("[\u6570\u636e\u5e93] [\u65b0\u589e\u8bb0\u5f55] \u5931\u8d25\uff1a",t)}})},updateData:function(t,e){this.db.collection("challengeCounters").doc(this.counterid).update({data:Object.assign({date:new Date},t),success:e,fail:function(t){console.error("[\u6570\u636e\u5e93] [\u66f4\u65b0\u8bb0\u5f55] \u5931\u8d25\uff1a",t)}})},hasReplay:!1},cc._RF.pop()},{}],OverCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"ad19cEPgGpNio7PxiYaBZOj","OverCtrl");var o=t("../Global/Global");cc.Class({extends:cc.Component,properties:{score:cc.RichText,desc:cc.Label},onLoad:function(){},setting:function(){this.score.string="\u672c\u6b21\u5f97\u5206<br/>"+this.gameView.score,this.desc.string="\u6bcf\u59295\u6b21\u590d\u6d3b\u673a\u4f1a\uff0c\u4eca\u65e5\u5269\u4f59\uff1a"+o.challengeCounters+"\u6b21"},skip:function(){o.rankViewStatus=1,cc.director.loadScene("rank")},share:function(){var t=this;console.log("onShare"),wx.shareAppMessage({title:o.shareTitle,imageUrl:o.shareImageUrl}),o.challengeCounters>0&&!o.hasReplay&&o.updateData({counters:o.challengeCounters-1},function(e){console.log("\u590d\u6d3b\u6210\u529f"),o.hasReplay=!0,t.node.removeFromParent(),t.gameView.clearGame(!0),t.gameView.canTouchStart=!0})}}),cc._RF.pop()},{"../Global/Global":"Global"}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"77cadpxUZRO2ql+MLV+ZuIs","Player"),cc.Class({extends:cc.Component,properties:{gameView:cc.Node,activeNode:cc.Node,overNode:cc.Node},onLoad:function(){cc.director.getCollisionManager().enabled=!0,this.overNode.runAction(cc.hide())},onCollisionEnter:function(t){var e=this.gameView.getComponent("GameView");this.node.y>=e.initY&&this.node.y<=e.initY+120&&e.isStart&&("Tree"===t.node.name?(console.log("game over"),this.gameOver(),e.gameOver()):"Gold"===t.node.name&&(e.getGold(),t.node.runAction(cc.removeSelf())))},gameOver:function(){this.activeNode.runAction(cc.hide()),this.overNode.runAction(cc.show())}}),cc._RF.pop()},{}],RankView:[function(t,e,i){"use strict";cc._RF.push(e,"e9620nXcKBMDo+6QzBkQkh6","RankView");var o=t("../Global/Global");cc.Class({extends:cc.Component,properties:{btnBack:cc.Node,btnGroupRank:cc.Node,btnHome:cc.Node,btnHome2:cc.Node,btnPlayAgain:cc.Node,btnChallenge:cc.Node,btnStart:cc.Node},onLoad:function(){0===o.rankViewStatus?(this.btnHome.removeFromParent(),this.btnHome2.removeFromParent(),this.btnPlayAgain.removeFromParent(),this.btnChallenge.removeFromParent(),this.btnStart.removeFromParent()):1===o.rankViewStatus?(this.btnHome2.removeFromParent(),this.btnBack.removeFromParent(),this.btnGroupRank.removeFromParent(),this.btnStart.removeFromParent()):(this.btnHome.removeFromParent(),this.btnBack.removeFromParent(),this.btnGroupRank.removeFromParent(),this.btnPlayAgain.removeFromParent(),this.btnChallenge.removeFromParent())},back:function(){cc.director.loadScene("game")},share:function(){cc.log("onShare"),wx.shareAppMessage({title:o.shareTitle,imageUrl:o.shareImageUrl})}}),cc._RF.pop()},{"../Global/Global":"Global"}],Stair:[function(t,e,i){"use strict";cc._RF.push(e,"b408awkSpRBPri4LoPCjvhR","Stair"),cc.Class({extends:cc.Component,properties:{barrierNum:0,posiNum:0,barrierPositions:[],barriers:[cc.Node],noBarrier:!1,barrierPrefab:cc.Prefab,goldPrefab:cc.Prefab,gold:cc.Node,goldPosition:-2},onLoad:function(){this.noBarrier||this.init()},init:function(){this.randomPosition(),this.createBarrier(),this.createGold()},randomPosition:function(){this.barrierPositions.length=0;for(var t=[],e=0,i=0,o=0;e<this.posiNum;)t.push(e++);for(this.goldPosition=parseInt((t.length-4)*Math.random()+2,10),t.splice(this.goldPosition,1);i<this.barrierNum;)o=parseInt(t.length*Math.random(),10),this.barrierPositions.push(t[o]),t.splice(o,1),i+=1;this.barrierPositions.sort(function(t,e){return t>e})},createBarrier:function(){for(var t=this;this.barrierPositions.length!==this.barriers.length;){var e=cc.instantiate(this.barrierPrefab);this.barriers.push(e),this.node.addChild(e)}this.barriers.forEach(function(e,i){e.setPosition(cc.v2(70*t.barrierPositions[i]-350+35,110))})},createGold:function(){this.gold||(this.gold=cc.instantiate(this.goldPrefab)),this.gold._parent||this.node.addChild(this.gold),this.gold.setPosition(cc.v2(70*this.goldPosition-350+35,110))}}),cc._RF.pop()},{}]},{},["Global","CtrlView","GameView","OverCtrl","Player","RankView","Stair"]);