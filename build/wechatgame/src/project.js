window.__require=function e(t,i,s){function o(a,r){if(!i[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var h="function"==typeof __require&&__require;if(!r&&h)return h(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+a+"'")}}var l=i[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,i,s)}return i[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<s.length;a++)o(s[a]);return o}({CtrlView:[function(e,t,i){"use strict";cc._RF.push(t,"fc7a1Vco1RLp45w+aBK076Z","CtrlView");var s=e("../Global/Global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){s.ctrlView=this},startGame:function(){this.node.runAction(cc.removeSelf()),this.gameView.startGame()},redirectToRank:function(){s.rankViewStatus=0,cc.director.loadScene("rank")}}),cc._RF.pop()},{"../Global/Global":"Global"}],GameView:[function(e,t,i){"use strict";cc._RF.push(t,"74384f4Pr1Au47VINXpucOD","GameView");var s=e("../Global/Global"),o="";o=wx.getOpenDataContext(),cc.Class({extends:cc.Component,properties:{isStart:!1,gameCanvas:cc.Node,ctrlViewPrefab:cc.Prefab,ctrlView:cc.Node,stair:cc.Prefab,stairs:[cc.Node],player:cc.Node,progressBox:cc.Node,progress:cc.Node,overViewPrefab:cc.Prefab,primaryHeight:263,firstEndScaleX:.72,firstEndScaleY:.72,firstY:200,firstEndY:0,speed:0,initSpeed:100,addSpeed:20,maxSpeed:200,scaleXChange:.09,scaleYChange:.09,initX:0,initYDistance:0,initY:0,jumpHeight:350,moveTime:0,isTouch:!1,prevTouchX:0,x:0,canTouchStart:!1,goldContinuousCount:0,score:0,addCount:0,scoreLabel:cc.RichText,step:0,preStep:0,maxStep:100},onLoad:function(){var e=this;s.joinFirst&&(s.joinFirst=!1,this.checkQuery()),this.createCtrlView(),this.createStair(),this.initPlayer(),this.speed=this.initSpeed,s.gameView=this,wx.updateShareMenu({withShareTicket:!0}),wx.onShareAppMessage(function(){return{title:s.shareTitle,imageUrl:s.shareImageUrl}}),wx.cloud?(wx.cloud.init(),s.db=wx.cloud.database()):console.error("\u8bf7\u4f7f\u7528 2.2.3 \u6216\u4ee5\u4e0a\u7684\u57fa\u7840\u5e93\u4ee5\u4f7f\u7528\u4e91\u80fd\u529b"),s.openid?this.getData():wx.cloud.callFunction({name:"login",data:{},success:function(t){console.log("[\u4e91\u51fd\u6570] [login] user openid: ",t.result.openid),s.openid=t.result.openid,e.getData(),o.postMessage({type:1,openid:t.result.openid})},fail:function(e){console.error("[\u4e91\u51fd\u6570] [login] \u8c03\u7528\u5931\u8d25",e)}})},update:function(e){var t=this;if(this.isStart){var i=(this.firstY-this.firstEndY)/this.speed;this.stairs.forEach(function(s,o){if(0===o)s.y-=t.speed*e,s.scaleX+=t.firstEndScaleX/i*e,s.scaleY+=t.firstEndScaleY/i*e;else{s.scaleX+=t.scaleXChange/i*e,s.scaleY+=t.scaleYChange/i*e;var n=t.stairs[o-1],a=t.primaryHeight/2*n.scaleY,r=t.primaryHeight/2*s.scaleY;s.y=n.y-a-r}}),this.moveTime+=e;var s=i/2,o=2*this.jumpHeight/(s*s),n=o*s-o*this.moveTime;this.player.y+=n*e,this.isTouch&&this.isStart&&(this.x>-312&&this.x<312?this.player.x=this.x:this.x=this.player.x)}},lateUpdate:function(){if(this.stairs[0].y<=this.firstEndY){this.addStep();var e=this.stairs.pop();e.getComponent("Stair").init(),this.stairs.unshift(e),e.scaleX=0,e.scaleY=0,e.y=this.firstY,this.step>this.maxStep-2&&e.runAction(cc.hide()),this.step>this.maxStep&&this.gameOver(!0),this.player.y=this.initY,this.moveTime=0}this.player.y>=this.initY+this.jumpHeight&&(this.player.y=this.initY+this.jumpHeight)},createCtrlView:function(){this.ctrlView||(this.ctrlView=cc.instantiate(this.ctrlViewPrefab),this.ctrlView.getComponent("CtrlView").gameView=this),this.gameCanvas.addChild(this.ctrlView)},createStair:function(){for(var e=0;e<5;){var t=cc.instantiate(this.stair),i=t.getComponent("Stair");if(i.gameView=this.node,e>1&&(i.noBarrier=!0),this.stairs[e]=t,this.node.addChild(t),0===e)t.scaleX=0,t.scaleY=0,t.setPosition(cc.v2(0,this.firstY));else{t.scaleX=this.firstEndScaleX+(e-1)*this.scaleXChange,t.scaleY=this.firstEndScaleY+(e-1)*this.scaleYChange;var s=this.stairs[e-1],o=this.primaryHeight/2*s.scaleY,n=this.primaryHeight/2*t.scaleY;t.setPosition(cc.v2(0,s.y-o-n)),1===e&&(this.firstEndY=t.y),3===e&&(this.initY=t.y+this.initYDistance),this.player.y=this.initY}e+=1}},initPlayer:function(){this.player.x=this.initX,this.player.y=this.initY,this.player.setSiblingIndex(10),this.progressBox.setSiblingIndex(10),this.x=this.initX},touchStartHandle:function(e){this.canTouchStart&&(this.isStart=!0,this.canTouchStart=!1),this.isTouch=!0,this.prevTouchX=e.getLocation().x},touchMoveHandle:function(e){var t=e.getLocation().x,i=t-this.prevTouchX;(this.x>-312&&this.x<294||this.x<=-312&&i>0||this.x>=294&&i<0)&&(this.x+=i,this.prevTouchX=t)},touchEndHandle:function(e){this.isTouch=!1},startGame:function(){this.isStart=!0,s.hasReplay=!1,this.node.on("touchmove",this.touchMoveHandle,this),this.node.on("touchstart",this.touchStartHandle,this),this.node.on("touchend",this.touchEndHandle,this)},gameOver:function(e){var t=this;if(this.isStart=!1,!s.hasReplay&&!e&&s.challengeCounters>0){var i=cc.instantiate(this.overViewPrefab),o=i.getComponent("OverCtrl");o.gameView=this,this.scheduleOnce(function(){o.setting(),t.gameCanvas.addChild(i)},1.5)}else this.updateData(),s.rankViewStatus=1,cc.director.loadScene("rank")},getGold:function(){this.step===this.preStep+1?this.goldContinuousCount+=1:this.goldContinuousCount=1,this.preStep=this.step,this.goldContinuousCount>4?this.addCount=50:this.addCount=20+10*(this.goldContinuousCount-1),this.score+=this.addCount,this.scoreLabel.string="<color=#19C1A7><b>"+this.score+"</b><color>"},addStep:function(){this.step+=1;var e=this.step/100*430;this.progress.height=e>25?e:25,this.speed<this.maxSpeed?this.speed=this.initSpeed+20*parseInt(this.step/10,10):this.speed=this.maxSpeed},clearGame:function(e){e||(this.score=0,this.step=0,this.progress.height=25),this.stairs.forEach(function(e){return e.removeFromParent()}),this.stairs.length=0,this.createStair(),this.initPlayer(),this.goldContinuousCount=0,this.addCount=0,this.preStep=0,this.scoreLabel.string="<color=#19C1A7><b>"+this.score+"</b><color>",this.moveTime=0;var t=this.player.getComponent("Player");t.activeNode.runAction(cc.show()),t.overNode.runAction(cc.hide())},getData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.openid;s.queryData(e,function(e){console.log("[\u6570\u636e\u5e93] [\u67e5\u8be2\u8bb0\u5f55] \u6210\u529f: ",e);var t=e.data;0===t.length?(s.addData({counters:s.challengeCountersAll,score:0}),s.challengeCounters=s.challengeCountersAll):s.dateIsToday(t[0].date)?(s.challengeCounters=t[0].counters,s.counterid=t[0]._id):(s.updateData({counters:s.challengeCountersAll},null),s.counterid=t[0]._id,s.challengeCounters=s.challengeCountersAll)})},updateData:function(){var e=this;console.log("\u4e0a\u62a5\u6210\u7ee9"),s.queryData(s.openid,function(t){console.log("\u4e0a\u62a5\u524d\u67e5\u8be2\u7ed3\u679c",t),t.data[0].score<e.score&&s.updateData({score:e.score})}),o.postMessage({type:0,data:{score:this.score,update_time:(new Date).getTime()}})},checkQuery:function(){console.log("getLaunchOptionsSync:",wx.getLaunchOptionsSync());var e=wx.getLaunchOptionsSync(),t=e.shareTicket;t&&o.postMessage({type:2,shareTicket:t});var i=e.query;"rank"===i.view&&(s.rankViewStatus=parseInt(i.status,10),cc.director.loadScene("rank"))}}),cc._RF.pop()},{"../Global/Global":"Global"}],Global:[function(e,t,i){"use strict";cc._RF.push(t,"cddabeYMPRAybU78zrtQXz3","Global"),t.exports={rankViewStatus:0,shareTitle:"\u5206\u4eab\u6807\u9898",shareImageUrl:"http://static.live.nagezan.net/live/19cc06e0-3a5f-48d5-93f9-d0414cd21f51.jpg",openid:"",challengeCountersAll:5,challengeCounters:0,db:"",counterid:"",queryData:function(e,t){this.db.collection("challengeCounters").where({_openid:e}).get({success:t,fail:function(e){console.error("[\u6570\u636e\u5e93] [\u67e5\u8be2\u8bb0\u5f55] \u5931\u8d25\uff1a",e)}})},addData:function(e){var t=this;this.db.collection("challengeCounters").add({data:Object.assign({date:new Date},e),success:function(e){console.log("[\u6570\u636e\u5e93] [\u65b0\u589e\u8bb0\u5f55] \u6210\u529f\uff0c\u8bb0\u5f55 _id: ",e._id),t.counterid=e._id},fail:function(e){console.error("[\u6570\u636e\u5e93] [\u65b0\u589e\u8bb0\u5f55] \u5931\u8d25\uff1a",e)}})},updateData:function(e,t){this.db.collection("challengeCounters").doc(this.counterid).update({data:Object.assign({date:new Date},e),success:t,fail:function(e){console.error("[\u6570\u636e\u5e93] [\u66f4\u65b0\u8bb0\u5f55] \u5931\u8d25\uff1a",e)}})},hasReplay:!1,joinFirst:!0,dateIsToday:function(e){var t=new Date,i=t.getFullYear(),s=t.getMonth(),o=t.getDate(),n=new Date(i,s,o);return e.getTime()>=n.getTime()}},cc._RF.pop()},{}],OverCtrl:[function(e,t,i){"use strict";cc._RF.push(t,"ad19cEPgGpNio7PxiYaBZOj","OverCtrl");var s=e("../Global/Global");cc.Class({extends:cc.Component,properties:{score:cc.RichText,desc:cc.Label},onLoad:function(){},setting:function(){this.score.string="\u672c\u6b21\u5f97\u5206<br/>"+this.gameView.score,this.desc.string="\u6bcf\u59295\u6b21\u590d\u6d3b\u673a\u4f1a\uff0c\u4eca\u65e5\u5269\u4f59\uff1a"+s.challengeCounters+"\u6b21"},skip:function(){this.gameView.updateData(),s.rankViewStatus=1,cc.director.loadScene("rank")},share:function(){var e=this;console.log("onShare"),wx.shareAppMessage({title:s.shareTitle,imageUrl:s.shareImageUrl,query:"view=rank&status=2",success:function(e){console.log("\u5206\u4eab\u6210\u529f",e)}}),s.challengeCounters>0&&!s.hasReplay&&s.updateData({counters:s.challengeCounters-1},function(t){console.log("\u590d\u6d3b\u6210\u529f"),s.hasReplay=!0,e.node.removeFromParent(),e.gameView.clearGame(!0),e.gameView.canTouchStart=!0})}}),cc._RF.pop()},{"../Global/Global":"Global"}],Player:[function(e,t,i){"use strict";cc._RF.push(t,"77cadpxUZRO2ql+MLV+ZuIs","Player"),cc.Class({extends:cc.Component,properties:{gameView:cc.Node,activeNode:cc.Node,overNode:cc.Node},onLoad:function(){cc.director.getCollisionManager().enabled=!0,this.overNode.runAction(cc.hide())},onCollisionEnter:function(e){var t=this.gameView.getComponent("GameView");this.node.y>=t.initY&&this.node.y<=t.initY+100&&t.isStart&&("Tree"===e.node.name?(console.log("game over"),this.gameOver(),t.gameOver()):"Gold"===e.node.name&&(t.getGold(),e.node.runAction(cc.removeSelf())))},gameOver:function(){this.activeNode.runAction(cc.hide()),this.overNode.runAction(cc.show())}}),cc._RF.pop()},{}],RankView:[function(e,t,i){"use strict";cc._RF.push(t,"e9620nXcKBMDo+6QzBkQkh6","RankView");var s=e("../Global/Global");cc.Class({extends:cc.Component,properties:{btnBack:cc.Node,btnGroupRank:cc.Node,btnHome:cc.Node,btnHome2:cc.Node,btnPlayAgain:cc.Node,btnChallenge:cc.Node,btnStart:cc.Node},onLoad:function(){0===s.rankViewStatus?(this.btnHome.removeFromParent(),this.btnHome2.removeFromParent(),this.btnPlayAgain.removeFromParent(),this.btnChallenge.removeFromParent(),this.btnStart.removeFromParent()):1===s.rankViewStatus?(this.btnHome2.removeFromParent(),this.btnBack.removeFromParent(),this.btnGroupRank.removeFromParent(),this.btnStart.removeFromParent()):(this.btnHome.removeFromParent(),this.btnBack.removeFromParent(),this.btnGroupRank.removeFromParent(),this.btnPlayAgain.removeFromParent(),this.btnChallenge.removeFromParent())},back:function(){cc.director.loadScene("game")},directToGameView:function(){cc.director.loadScene("game")},share:function(){console.log("onShare"),wx.shareAppMessage({title:s.shareTitle,imageUrl:s.shareImageUrl,query:"view=rank&status=2",success:function(e){console.log("\u5206\u4eab\u6210\u529f",e)}})},startGame:function(){cc.director.loadScene("game",function(e){s.ctrlView.startGame()})}}),cc._RF.pop()},{"../Global/Global":"Global"}],Stair:[function(e,t,i){"use strict";cc._RF.push(t,"b408awkSpRBPri4LoPCjvhR","Stair"),cc.Class({extends:cc.Component,properties:{barrierNum:0,posiNum:0,barrierPositions:[],barriers:[cc.Node],noBarrier:!1,barrierPrefab:cc.Prefab,goldPrefab:cc.Prefab,gold:cc.Node,goldPosition:-2,distance:75},onLoad:function(){this.noBarrier||this.init()},init:function(){this.randomPosition(),this.createBarrier(),this.createGold()},randomPosition:function(){this.barrierPositions.length=0;for(var e=[],t=0,i=0,s=0;t<this.posiNum;)e.push(t++);for(this.goldPosition=parseInt((e.length-4)*Math.random()+2,10),e.splice(this.goldPosition,1);i<this.barrierNum;)s=parseInt(e.length*Math.random(),10),this.barrierPositions.push(e[s]),e.splice(s,1),i+=1;this.barrierPositions.sort(function(e,t){return e>t})},createBarrier:function(){for(var e=this;this.barrierPositions.length!==this.barriers.length;){var t=cc.instantiate(this.barrierPrefab);this.barriers.push(t),this.node.addChild(t)}this.barriers.forEach(function(t,i){t.setPosition(cc.v2(70*e.barrierPositions[i]-350+35,e.distance))})},createGold:function(){this.gold||(this.gold=cc.instantiate(this.goldPrefab)),this.gold._parent||this.node.addChild(this.gold),this.gold.setPosition(cc.v2(70*this.goldPosition-350+35,this.distance))}}),cc._RF.pop()},{}]},{},["Global","CtrlView","GameView","OverCtrl","Player","RankView","Stair"]);